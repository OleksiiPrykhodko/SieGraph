import { Component, Input, OnInit, AfterContentChecked, OnDestroy} from '@angular/core';
import {
  Chart,
  ChartType,
  ChartOptions,
  ChartData,
  Colors,
  BubbleController,
  CategoryScale,
  LinearScale,
  PointElement,
  Legend,
  registerables,
} from 'node_modules/chart.js';
import {GraphPoint} from '../../models/graph/graph-point';

Chart.register(...registerables);

@Component({
  selector: 'app-graph',
  templateUrl: './graph.component.html',
  styleUrls: ['./graph.component.scss'],
})

export class GraphComponent {

  @Input() public GraphPoints: GraphPoint[];
  @Input() public GraphUniqueName: string;

  constructor() {
  }

  ngOnInit(){
  this._yAxisDataSet ={
    // min and max values
    labels: ['0','1'],
    datasets: [{
      // min and max value from incoming data
      data: [Math.min(...(this.GraphPoints.map(point => point.Y))),
            Math.max(...(this.GraphPoints.map(point => point.Y)))],
      borderWidth: 0
    }]
  };

  this._currentChartDataSet = {
    labels: this.GraphPoints.map(point => point.X),
    datasets: [{
      label: ' Value ',
      data: this.GraphPoints.map(point => point.Y),
      borderWidth: this._lineWidthOnGraph
    }]
  };

  }

  ngAfterViewInit(){
    this.ShowGraph();
  }

  ngOnDestroy(){
    this._yAxisChart.destroy();
    this._currentChart.destroy();
  }

  private _yAxisId: string = "graphYAxis";
  private _yAxisDataSet : any;
  private _yAxisChart: Chart;
  private _currentChartDataSet: any;
  private _currentChart: Chart;

  private _lineWidthOnGraph: number = 3;
  // The number of points after which the distance between points becomes fixed.
  private _borderNumberOfPointsForFixedGraphWidth: number = 8;
  // The distance in pixels between two points on the x-axis in.
  private _distanceBetweenPoints: number = 140;

  public YAxisId(): string{
    return `${this._yAxisId}-${this.GraphUniqueName}`;
  }

  // Data for seeding:

  // 10 = '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM'
  // 10 = 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342

  // 200 = '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM' ,'2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM','2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM','2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM' ,'2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM','2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM','2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:20 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM', '2/10/2023 5:45:25 PM'
  // 200 = 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342, 2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342,2147383648, 99543251, 395567546, 1234234234, 223459235, 323549993, 234592359, 93239845, 523499752, 223633342

  private _yAxisChartOptions = {
    maintainAspectRatio: false,
    layout:{
      padding: { bottom : 56}
    },
    plugins: {
      legend: {display : false},
    },
    scales: {
      x:{
        ticks: {display : false},
        grid: {drawTicks : false}
      },
      y: {
        beginAtZero: true,
        afterFit: (ctx : any) => {ctx.width = 87}
      }
    }
  };

  private _chartOptions = {
    maintainAspectRatio: false,
    layout:{
      padding: { top : 10, bottom: 10}
    },
    plugins: {
      legend: {display : false},
    },
    scales: {
      //x: {
      //  ticks: {display : true,
      //    align: 'start'
      //  }
      //},
      y: {
        beginAtZero: true,
        ticks: {display : false},
        grid: {
          drawTicks : false
        }
      }
    }
  };

  ShowGraph(){
    // This is chart only for creating Y axis.
    this._yAxisChart = new Chart(this.YAxisId(), {
      type: 'bar',
      data: this._yAxisDataSet,
      options: this._yAxisChartOptions
    });

    // This is real chart.
    this._currentChart = new Chart(this.GraphUniqueName, {
      type: 'line',
      data: this._currentChartDataSet,
      options: this._chartOptions
    });

    var box = document.querySelector<HTMLElement>(".box");
    var barLength = this._currentChart.data.labels!.length;

    if(barLength > this._borderNumberOfPointsForFixedGraphWidth){
      var chartWidth = barLength * this._distanceBetweenPoints;
      box!.style.width = `${chartWidth}px`;
    }


  }

}
